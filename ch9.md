# c语言文件操作

==新港挣钱新港花，新港的男人不回家==



## 什么是文件

​		磁盘上的文件是文件。

​		但是在程序设计中，我们一般谈的文件有两种：程序文件、数据文件。

### 程序文件

​		包括源程序文件(后缀为.c )，目标文件(windows环境后缀为.obj)， 可执行程序(windows环境后缀为.exe)。

### 数据文件

​		文件的内容不一定是程序，而是程序运行时读写的数据，比如程序运行需要从中读取数据的文件，或者输出内容的文件。

​		本章讨论的是数据文件。

​		在以前各章所处理数据的输入输出都是以终端为对象的，即从终端的键盘输入数据，运行结果显示到显示器上。其实有时候我们会把信息输出到磁盘上，当需要的时候再从磁盘上把数据读取到内存中使用，这里处理的就是磁盘上的文件

## 文件名

​		一个文件要有唯一的文件标识，以便用户识别和引用。

​		文件名包含三部分：文件路径 + 文件名主干 + 文件后缀

​		例如： `c:\code\test.txt`

​		为了方便起见，文件标识常被称为文件名。

## 文件类型

​		根据数据的组织形式，数据文件被称为文本文件和二进制文件。

​		数据在内存中以二进制的形式存储，如果不加转换的输出到外存，就是二进制文件。如果要求在外存上以ASCII码的形式存储，则需要在存储前转换。以ASCIII字符的形式存储的文件就是文本文件。

​		一个数据在内存中是怎么存储的呢？

​		字符一律以`ASCII`形式存储，数值型数据既可以用ASCII形式储存，也可以使用二进制形式存储。如有整数10000，如果以`ASCII`码的形式输出到磁盘，则磁盘中占用五个字节(每个字符一个字节)，而二进制形式则在磁盘上只占四个字节。	

![image-20220112155351740](/home/hl/桌面/C_code/IMG/image-20220112155351740.png)

```
#include <stdio.h>
int main(void)
{
	int a = 10000;
	FILE* pf = fopen("test.txt","wb");
	fwrite(&a,4,1,pf);   	// 二进制的形式写到文件中
	fclose(pf);
	pf = NULL;
	return 0;
}
```



## 文件缓存区

​		ANSIC标准采用“缓冲文件系统”处理数据文件，所谓缓冲文件系统是指系统自动地在内存中为程序中每一个正在使用的文件开辟一块“文件缓冲区”。从内存向磁盘输出数据会先送到内存中的缓冲区(装满缓冲区)，然后再从缓冲区逐个将数据送到程序数据区(程序变量等)。缓冲区的大小根据C编译系统决定的。

![image-20220112160828384](/home/hl/桌面/C_code/IMG/image-20220112160828384.png)



## 文件指针

​		缓冲文件系统中，关键的概念是“文件类型指针”，简称“文件指针”。

​		每个被使用的文件都在内存中开辟了一个相应的文件信息区，用来存放文件的相关信息(如文件的名字，文件状态及文件当前的位置等)。这些信息是保存在一个结构体变量中的。该结构体类型是有系统声明的，取名`FILE`。

​		例如`stdio.h`头文件中有一下的文件类型声明：

![image-20220112162312893](/home/hl/桌面/C_code/IMG/image-20220112162312893.png)

​		不同的`C`编译器的`FILE`类型包含的内容不完全相同，但是大同小异。

​		每当打开一个文件的时候，系统会根据文件的情况自动创建一个`FILE`结构的变量，并填充其中的信息，使用者不必关心细节。一般都是通过一个`FILE`的指针来维护这个FILE结构的变量，这样使用起来更加方便。

​		下面我们可以创建一个`FILE*`的指针变量: 

```
FILE *pf;
```

 		定义pf是指向FILE类型数据的指针变量。可以使pf指向某个文件的文件信息区(是一个结构体变量)。通过该文件信息区中的信息就能够访问该文件。也就是说，通过文件指针变量能够找到与它向关联的文件。

​		比如：

![image-20220112163221829](/home/hl/桌面/C_code/IMG/image-20220112163221829.png)

## 文件的打开和关闭

​		文件在读写之前应该先打开文件，在使用结束之后应该关闭文件。

​		在编写程序的时候，在打开文件的同时，都会返回一个FILE*的指针变量指向该文件，野相当于建立了指针和文件的关系。

​		`ANSIC`规定使用`fopen`函数来打开文件，`fclose`来关闭文件。

```
FILE fopen(const char * filename, const char * mode);
int fclose (FILE * stream);
```

​		打开方式如下：

| 文件使用方式 | 含义                                     | 如果指定文件不存在 |
| ------------ | ---------------------------------------- | ------------------ |
| "r"(只读)    | 为了输入数据，打开一个已经存在的文本文件 | 出错               |
| “w”(只写)    | 为了输出数据，打开一个文本文件           | 建立一个新的文件   |
| “a”(追加)    | 向文本文件尾添加数据                     | 出错               |
| "rb"(只读)   | 为了输入数据，打开一个二进制文件         | 出错               |
| "wb"(只写)   | 为了输出数据，打开一个二进制文件         | 建立一个新的文件   |
| "ab"(追加)   | 向一个二进制文件尾添加数据               | 出错               |
| "r+"(读写)   | 为了读和写，打开一个文本文件             | 出错               |
| "w+"(读写)   | 为了读和写，建立一个新的文件             | 建立一个新的文件   |
| "a+"(读写)   | 打开一个文件，在文件尾进行读写           | 建立一个新的文件   |
| "rb+"(读写)  | 为了读和写，打开一个二进制文件           | 出错               |
| "wb+"(读写)  | 为了读和写，新建一个新的二进制文件       | 建立一个新的文件   |
| "ab+"(读写)  | 打开一个二进制文件，在文件尾进行读和写   | 建立一个新的文件   |

示例代码：

```
#include <stdio.h>
#include <string.h>
#include <errno.h>
int main()
{
	// 打开文件
	FILE* pf = fopen("test.txt","w");
	if (pf == NULL)
	{
        printf("Filed!\n");
		printf("%s\n",strerror(errno));
        return 0;
	}
	// 读取成功
	// 关闭文件
	fclose(pf);
	pf = NULL;
	printf("Successfully!\n");

	return 0;
}
```



## 文件的顺序读写

![image-20220112170913003](IMG/image-20220112170913003.png)

```
int main()
{
	// 打开文件
	FILE* pf = fopen("test.txt","w");
	if (pf == NULL)
	{
        printf("Filed!\n");
		printf("%s\n",strerror(errno));
        return 0;
	}
	// 写文件
	fputs('b',pf);
	fputs('b',pf);
	fputs('b',pf);
	// 关闭文件
	fclose(pf);
	pf = NULL;
	printf("Successfully!\n");

	return 0;
}
```



## 文件的随机读写



## 文件结束的判定